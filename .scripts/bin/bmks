#! /bin/bash

# set prefered launcher
PREFERED_LAUNCHER=dmenu
# set path where urls will be stored
URL_FILE_PATH=$HOME/.bmks/
# name of file urls will be stored in
URL_FILE_NAME=urls
# number of lines shown in the dmenu
DMENU_LINE_DISPLAY=8

show_usage() {
	printf "bmks: unix bookmark management that sucks less

usage:
bmks help
	show this help message
bmks ls
	show all bookmarks
bmks dmenu
	manual switch for displaying bookmarks in dmenu

To add bookmarks open ${URL_FILE_PATH}${URL_FILE_NAME} in a text editor and add your bookmark in
the format: title - URL (for example google - https://google.com)

Configuration is done by directly editing the script. dmenu is the only
supported launcher. it will allow you to choose a bookmark and open it in your
default browser.

If you would prefer to have your bookmarks stored in alternate location there
are also variables that can be changed for that. The default is
/home/user/.bmks/urls\n"
}

bmks_ls() {
	bmks_check
	grep -vE "#|^$" $URL_FILE_PATH/$URL_FILE_NAME | sort
}

bmks_display() {
	bmks_check
	case $PREFERED_LAUNCHER in
        dmenu) grep -vE "#|^$" $URL_FILE_PATH/$URL_FILE_NAME | sort | dmenu -l ${DMENU_LINE_DISPLAY} | awk '{print $(NF)}' | xargs -I '{}' $BROWSER {} ;;
        # in case if you want to add another launchers
	esac
}

bmks_check() {
	[ ! -s $URL_FILE_PATH/$URL_FILE_NAME ] && printf "Error: No bookmarks found to display. Try adding some!\n\n" && show_usage && exit 0
}

[ ! -d $URL_FILE_PATH ] && mkdir $URL_FILE_PATH
[ ! -f $URL_FILE_PATH/$URL_FILE_NAME ] && touch $URL_FILE_PATH/$URL_FILE_NAME

case "$1" in
	"help") show_usage ;;
	"add") url=$2; bmks_add ;;
	"ls") bmks_ls ;;
	"dmenu") PREFERED_LAUNCHER=$1; bmks_display ;;
	*) bmks_display ;;
esac
